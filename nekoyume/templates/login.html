{% extends 'layout.html' %}
{% block title %}Login{% endblock %}
{% block body %}
Nek√∏yume
<div>
    <h2>{% trans %}Welcome!{% endtrans %}</h2>
</div>
<div>
    <p>{% trans %}Hello! Welcome to the world of Nekoyume. Please set your own private key and input that in the form below so that you can start game right know. Private key is a password that identify you. Please make this unique.{% endtrans %}</p>
    {% if request.args.get('error') == 'invalid-private-key' %}
    <p>{% trans %}Please enter a valid private key of 64 hexadecimal digits (it can be optionally prefixed with <tt>0x</tt>).{% endtrans %}</p>
    {% endif %}
</div>
<div>
    <form action="{{ url_for('.post_login') }}" method="POST">
        <div>
            {% if 'username' in session and 'private_key' in session %}
            <input type="text" id="name" name="name" maxlength="10">
            <label for="name">{% trans %}Enter your name{% endtrans %}</label>
            <input type="text" id="private_key" name="private_key" pattern="^(0[Xx])?[A-Fa-f0-9]{64}$">
            <label for="private_key">{% trans %}Enter your private key{% endtrans %}</label>
            {% else %}
            <input type="text" id="name" name="name" maxlength="10">
            <label for="name">{% trans %}Enter your name{% endtrans %}</label>
            <input type="text" id="private_key" name="private_key" pattern="^(0[Xx])?[A-Fa-f0-9]{64}$">
            <label for="private_key">{% trans %}Enter your private key{% endtrans %}</label>
            {% endif %}
        </div>
        <input type="submit" value="{% trans %}OK{% endtrans %}">
    </form>
</div>
{% if 'username' not in session and 'private_key' not in session %}
<script src="https://cdn.rawgit.com/weepy/brequire/master/require.js"></script>
<script>
window.setTimeout(function () {
    var elliptic = require(
		'https://cdn.rawgit.com/indutny/elliptic/v6.4.1/dist/elliptic.min.js'
	);
	var ec = new elliptic.ec('secp256k1');
	var keyPair = ec.genKeyPair();
	var privKey = keyPair.getPrivate();
	var input = document.getElementById('private_key');
	var hex = privKey.toString('hex');
	while (hex.length < 64) hex = '0' + hex;
	input.value = hex;
}, 0);
</script>
{% endif %}
{% endblock %}
