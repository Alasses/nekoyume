{% extends 'layout.html' %}
{% block title %}Login{% endblock %}
{% block style %}
<link rel="stylesheet" href="{{ static_url(filename='common.css') }}">
<style>
.zone00 {
    position: absolute;
    z-index: 1;
    width: 100%;
    height: 100%;
    background: url("{{ static_url(filename='dist/images/zone_0_0.png') }}") repeat-x;
}
.zone01 {
    position: absolute;
    z-index: 2;
    width: 100%;
    height: 100%;
    background: url("{{ static_url(filename='dist/images/zone_0_1.png') }}") repeat-x;
}
.zone02 {
    position: absolute;
    top: 460px;
    z-index: 3;
    width: 100%;
    height: 100%;
    background: url("{{ static_url(filename='dist/images/zone_0_2.png') }}") repeat-x;
}
.zone03 {
    position: absolute;
    top: 472px;
    z-index: 4;
    width: 100%;
    height: 100%;
    background: url("{{ static_url(filename='dist/images/zone_0_3.png') }}") repeat-x;
}
</style>
{% endblock %}
{% block body %}
<div class="background">
    <div class="zone00"></div>
    <div class="zone01"></div>
    <div class="zone02"></div>
    <div class="zone03"></div>
    <div class="gradient"></div>
</div>

<div class="box">
    <h1>Nek√∏yume</h1>
    <h4>{% trans %}Welcome!{% endtrans %}</h4>
    <div>
        <p>{% trans %}Hello! Welcome to the world of Nekoyume.{% endtrans %}</p>
        {% if request.args.get('error') == 'invalid-private-key' %}
        <p>{% trans %}Please enter a valid private key of 64 hexadecimal digits (it can be optionally prefixed with <tt>0x</tt>).{% endtrans %}</p>
        {% endif %}
    </div>
    <div>
        <div class="join">
            <h5>[{% trans %}Join{% endtrans %}]</h5>
            <form action="{{ url_for('.post_login') }}" method="POST">
                <div>
                    <label for="name">{% trans %}Name{% endtrans %}</label>
                    <br />
                    <input type="text" id="name" name="name" maxlength="10">
                    <br />
                    <label for="private_key">{% trans %}private key{% endtrans %}</label>
                    <a style="cursor: pointer; font-size: 0.9em;" class="copy-private-key material-icons">file_copy</a>
                    <br />
                    <input type="text" id="private_key" name="private_key" pattern="^(0[Xx])?[A-Fa-f0-9]{64}$">
                </div>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"
                        type="submit">{% trans %}OK{% endtrans %}</button>
            </form>
        </div>
        <div class="login">
            <h5>[{% trans %}Login{% endtrans %}]</h5>
            <form action="{{ url_for('.post_login') }}" method="POST">
                <div>
                    <label for="private_key_login">{% trans %}private key{% endtrans %}</label>
                    <br />
                    <input type="hidden" name="name" value="">
                    <input type="text" id="private_key_login" name="private_key" pattern="^(0[Xx])?[A-Fa-f0-9]{64}$">
                </div>
                <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"
                        type="submit">{% trans %}OK{% endtrans %}</button>
            </form>
        </div>
    </div>
</div>

<div id="toast" class="mdl-js-snackbar mdl-snackbar">
  <div class="mdl-snackbar__text"></div>
  <button class="mdl-snackbar__action" type="button"></button>
</div>

{% if 'username' not in session and 'private_key' not in session %}
{% endif %}
{% endblock %}
{% block script %}
<script src="https://cdn.rawgit.com/weepy/brequire/master/require.js"></script>
<script>
    window.setTimeout(function () {
        var elliptic = require(
            'https://cdn.rawgit.com/indutny/elliptic/v6.4.1/dist/elliptic.min.js'
        );
        var ec = new elliptic.ec('secp256k1');
        var keyPair = ec.genKeyPair();
        var privKey = keyPair.getPrivate();
        var input = document.getElementById('private_key');
        var hex = privKey.toString('hex');
        while (hex.length < 64) hex = '0' + hex;
        input.value = hex;
    }, 0);

    function scrollBg(name) {
        var position = $(name).css('background-position-x');
        console.log(position);
        if (!position)
            position = '0';
        var x = Number(position.replace(/[^0-9-]/g, '')) - 1;
        $(name).css('background-position-x', x +'px');
    }

    $(document).ready(function(){
        setInterval(function () {
            scrollBg('.zone00');
        }, 80);

        setInterval(function () {
            scrollBg('.zone01');
        }, 60);

        setInterval(function () {
            scrollBg('.zone02');
        }, 24);

        setInterval(function () {
            scrollBg('.zone03');
        }, 20);

        $('.copy-private-key').click(copyPrivateKey);
    });

    function copyPrivateKey() {
        var copyText = document.getElementById("private_key");
        copyText.select();
        document.execCommand("copy");

        var data = {message: 'Copied "' + copyText.value + '"'};
        var snackbarContainer = document.querySelector('#toast');
        snackbarContainer.MaterialSnackbar.showSnackbar(data);
      }
</script>
{% endblock %}
